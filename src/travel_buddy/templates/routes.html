<!DOCTYPE html>
<html>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<head>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/components/popup.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/components/transition.min.css">
	<link rel="stylesheet" href="../static/css/mobile.css">

	<title>Travel Buddy - Route Check</title>
	<script src="../static/javascript/autocomplete.js"></script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/components/transition.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/components/popup.min.js"></script>
	
	<script src={{autocomplete_query}} async></script>
</head>

	<div class="ui secondary pointing menu big nav">
		<a class="item" href="/profile">
			<i class="user icon"></i>
			<div class="mobile hidden">Profile</div>
		</a>
		
		<a class="item active" href="/routes">
			<i class="map icon"></i>
			<div class="mobile hidden">Route Analysis</div>
		</a>
		<a class="item" href="/carpools">
			<i class="car icon"></i>
			<div class="mobile hidden">Carpools</div>
		</a>
		<a class="item" href="/settings">
			<i class="settings icon"></i>
			<div class="mobile hidden">Settings</div>
		</a>
		<a class="item right" href="/logout">
			<i class="sign out alternate icon"></i>
			<div class="mobile hidden">Log out of {{username}}</div>
		</a>
	</div>

	<div class="ui container" style="background-color: transparent;">

	</div>
	<div class="ui grid stackable" style="height: 100%; margin: 0 2em 0 2em;">
		<div class="four wide column" style="text-align: center;">
			<div class="ui segment">
				<div class="ui dividing header">
					<i class="fa fa-route"></i>
					Route Check
				</div>
				<div id="collapsible">
					<div class="ui form">
						<form action="/routes" method="POST">
							<div class="field">
								<label>Start Point</label>
								<input id="input-1" type="text" required name="start_point" value="{{origin}}">
							</div>
							<div class="field">
								<label>Destination</label>
								<input id="input-2" type="text" required name="destination" value="{{destination}}">
							</div>
							
							<div class="row">
								<input type="hidden" id="mode" name="mode" value="driving">
								<div class="four fields">
									<div class="field">
										{% if mode == "driving" %}
											<div class="custom-radio active" data-value="driving"><i class="fas fa-car"></i></div>
										{% else %}
											<div class="custom-radio" data-value="driving"><i class="fas fa-car"></i></div>
										{% endif %}
									</div>
									<div class="field">
										{% if mode == "walking" %}
											<div class="custom-radio active" data-value="walking"><i class="fas fa-walking"></i></div>
										{% else %}
											<div class="custom-radio" data-value="walking"><i class="fas fa-walking"></i></div>
										{% endif %}
									</div>
									<div class="field">
										{% if mode == "cycling" %}
											<div class="custom-radio active" data-value="bicycling"><i class="fas fa-biking"></i></div>
										{% else %}
											<div class="custom-radio" data-value="bicycling"><i class="fas fa-biking"></i></div>
										{% endif %}
									</div>
									<div class="field">
										{% if mode == "public transport" %}
											<div class="custom-radio active" data-value="transit"><i class="fas fa-bus"></i></div>
										{% else %}
											<div class="custom-radio" data-value="transit"><i class="fas fa-bus"></i></div>
										{% endif %}
									</div>
								</div>
							</div>
							<button class="ui button black fluid" id="search_btn" style="font-size: 1.2em;">Search</button>
						</form>
					</div>
					{% if route_exists %}
					<div class="ui dividing header"><i class="fa fa-info-circle"></i> Route Info</div>
					<table class="ui very basic collapsing celled table" style="text-align: center; width: 100%;">
						{% if details is not none %}
						{% for item in details['modes'].keys() %}
						<tr>
							{% if details['modes'][item]['distance'] is not none %}
								{% if mode == item %}
									<td><b>{{item.capitalize()}}</b></td>
									<td><b>{{ details['modes'][item]['distance']['text'] }}</b></td>
									<td><b>{{ details['modes'][item]['duration']['text'] }}</b></td>
								{% else %}
									<td>{{item.capitalize()}}</td>
									<td>{{ details['modes'][item]['distance']['text'] }}</td>
									<td>{{ details['modes'][item]['duration']['text'] }}</td>
								{% endif %}
							{% endif %}
						</tr>
						{% endfor %}
						{% endif %}
					</table>
					<div class="ui label big fluid" style="text-align: center; background-color: #AED6F1;">{{distance_range}} <i class="fa fa-info-circle" data-content="Distance range for the above transport modes."></i></div>
					<br><br>
					<div class="ui grid">
						<div class="eight wide column">
							<button class="ui button black fluid" id="search_carpool_btn" style="font-size: 1em;">Search for Carpools</button>
						</div>
						<div class="eight wide column">
							<button class="ui button black fluid" id="create_carpool_btn" style="font-size: 1em;">Create a Carpool Offer</button>
						</div>
					</div>
					{% endif %}
				</div>
			</div>
		</div>
		<div class="eight wide column" style="align-self: stretch; margin: 0; padding: 0;">
			<div class="ui container compact" id="map_container">
				<iframe id="map_iframe" loading="lazy" allowfullscreen src={{map_query}} style="border-radius: 40px"></iframe>
				<div id="map"></div>
			</div>
		</div>
		<div class="four wide column">
			<div class="ui segment">
				{% if route_exists %}
				<div class="ui dividing header">
					<i class="fa fa-chart-area"></i>
					Route Statistics
				</div>
				<table class="ui very basic celled table" style="text-align: center; width: 100%;">
					<tr>
						<td width=50%>
							<i class="leaf icon"></i> CO2 Emissions:
							<br>
							{{co2_emissions}}{% if co2_emissions != "Unknown" %} kg{% endif %}
						</td>
						<td>
							<i class="pound sign icon"></i> Fuel Cost ({{car_make}}):
							<br>
							£{{fuel_cost}}
						</td>
					</tr>
				</table>
				<div class="ui list">
					<div class="item">
						<table class="ui very basic table" style="text-align: center; width: 100%;">
							<tr>
								<td width=50%>
									Average Fuel Cost (UK)
								</td>
								<td>
									£{{fuel_price}}
								</td>
							</tr>
						</table>
					</div>
					<div class="item">
						<table class="ui very basic table" style="text-align: center; width: 100%;">
							<tr>
								<td width=50%>
									Fuel Used (Litres)
								</td>
								<td>
									{{fuel_used}}
								</td>
							</tr>
						</table>
					</div>
					{% if min_distance != -1 %}
						{% if min_distance < 25000 %}
							<br>
							<div class="item">
								<i class="fa fa-info-circle" data-content="Everyone burns calories at different rates depending on weight
								and intensity of activity, but here's an estimate of how many calories you could burn.&#10;"></i>
								Calories Burned (<a href="https://bupa.co.uk/health-information/tools-calculators/calories-calculator" target="_blank">Source</a>)
							</div>
							<table class="ui very basic collapsing celled table" style="text-align: center; width: 100%;">
							{% for item, value in calories.items() %}
								<tr>
									{% if item.capitalize() == 'Walking' %}
										{% if details['modes']['walking']['distance'] is not none and details['modes']['walking']['distance']['value'] < 5000 %}
											<td>{{ item.capitalize() }}</td>
											<td>~ {{ value }} kcal</td>
										{% endif %}
									{% elif item.capitalize() == 'Running' %}
										{% if details['modes']['walking']['distance'] is not none and details['modes']['walking']['distance']['value'] < 10000 %}
											<td>{{ item.capitalize() }}</td>
											<td>~ {{ value }} kcal</td>
										{% endif %}
									{% elif item.capitalize() == 'Cycling' %}
										{% if details['modes']['walking']['distance'] is not none and details['modes']['cycling']['distance']['value'] < 25000 %}
											<td>{{ item.capitalize() }}</td>
											<td>~ {{ value }} kcal</td>
										{% endif %}
									{% endif %}
								</tr>
							{% endfor %}
							</table>
						{% endif %}
					{% endif %}
					{% if recommendations|length > 0 %}
					<div class="item">
						Recommendations
						<div class="ui bulleted list">
							{% for r in recommendations %}
								<div class="item">
								{{r|safe}}
								</div>
							{% endfor %}
						</div>	
					</div>
					{% endif %}
				</div>
				{% else %}

				Find a path first to see route statistics.

				{% endif %}
			</div>
		</div>
	</div>

</html>

<script>
	var custom_radio_elements = document.querySelectorAll(".custom-radio");

	custom_radio_elements.forEach(function(element) {
		element.addEventListener("click", function() {
			custom_radio_elements.forEach(function(element) {
				element.classList.remove("active");
			});
			this.classList.add("active");

			document.getElementById("mode").value = this.getAttribute("data-value");
		});
	});

	$('*[data-content]').popup();

</script>

<style>
	@import url("https://fonts.googleapis.com/css?family=Montserrat:400,800");

	* {
		box-sizing: border-box;
		transition: all 0.4s;
		font-family: "Open Sans", "Helvetica", "Montserrat", sans-serif;
	}

	.center-both-ways {
		display: flex;
		justify-content: center;
		align-items: center;
	}

	#toggle-view-button {
		cursor: pointer;
		color: #777777;
	}

	#toggle-view-button:hover {
		color: black;
	}

	#collapsible.hidden {
		display: none;
	}

	#collapsible {
		display: block;
	}

	body {
		background: #F4F9F4;
		/* display: flex; */
		/* justify-content: center; */
		/* align-items: center; */
		/* flex-direction: column; */
		font-family: "Montserrat", sans-serif;
		width: 100%;
		height: 100%;
	}

	#search_btn {
		background: #74B49B;
	}

	#search_btn:hover {
		background: #5C8D89;
	}

	#search_carpool_btn:hover {
		background: #5C8D89;
	}

	#create_carpool_btn:hover {
		background: #5C8D89;
	}

	#search_carpool_btn {
		background: #74B49B;
	}

	#create_carpool_btn {
		background: #74B49B;
	}

	#map_iframe {
		width: 100%;
		height: 100%;
		border: 0;
		z-index: 5;
		padding: 2em;
	}

	#map_container {
		width: 100%;
		height: 100%;
		display: flex;
		justify-content: center;
		align-items: center;
	}

	#container {
		z-index: 10;
		position: absolute;
		top: 0;
		left: 0;
		margin: 0.5em;
		width: 25em;
		/* background: #ff416c;
		background: -webkit-linear-gradient(to right, #ff4b2b, #ff416c);
		background: linear-gradient(to right, #ff4b2b, #ff416c); */
	}

	.custom-radio {
		padding: 0.5em;
		font-size: 1.5em;
		color: #333;
		display: flex;
		align-items: center;
		justify-content: center;
		border-radius: 0.2em;
		cursor: pointer;
	}

	.custom-radio:hover {
		background-color: #eaeaea;
		color: #5C8D89 !important;
	}

	.custom-radio:hover i {
		color: #5C8D89 !important;
	}

	.custom-radio.active i {
		color: #5C8D89 !important;
	}

	.custom-radio.active {
		position: relative;
		background-color: #ECF0F1;
		border-bottom: #d6d6d6 solid 4px;
		top: -4px;
		transition: none;
	}

	.custom-radio.active:hover {
		background-color: #D0D3D4;
		border-bottom: #c0c0c0 solid 4px;
	}

	/* .container {
		background-color: #fff;
		border-radius: 10px;
		box-shadow: 0 14px 28px rgba(0, 0, 0, 0.25), 0 10px 10px rgba(0, 0, 0, 0.22);
		position: relative;
		overflow: hidden;
		width: 1400px;
		max-width: 100%;
		min-height: 654px;
	} */

	.nav{
		background: -webkit-linear-gradient(to right, #2cafa4, #74B49B) !important;
		background: linear-gradient(to right, #2cafa4, #74B49B) !important;
		color: #FFFFFF !important;
		margin: 0rem !important;
	}

	.nav .item{
		color: #FFFFFF !important;	
	}
	
	.active{
		border-bottom-color: #FFFFFF !important;
	}

</style>
